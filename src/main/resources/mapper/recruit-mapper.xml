<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dmu.dasom.dasom_homepage.repository.RecruitRepository">
    <!-- 모집 일정 관련 쿼리 -->
    <insert id="createNewRecruitSchedule" parameterType="RecruitSchedule">
        INSERT INTO recruit_schedule(rec_no, rec_name, rec_description)
        VALUES (#{recNo}, #{recName}, #{recDescription});

        INSERT INTO recruit_period
        VALUES (#{recNo}, #{applyStart}, #{applyEnd}, #{firstAnnounce}, #{interviewStart}, #{interviewEnd}, #{secondAnnounce});
    </insert>

    <select id="getRecruitScheduleList" resultType="RecruitScheduleIndex">
        SELECT * FROM recruit_schedule_index;
    </select>

    <select id="getRecruitScheduleDetails" parameterType="int" resultType="RecruitSchedule">
        SELECT * FROM recruit_schedule_details WHERE rec_no = #{recNo};
    </select>

    <update id="updateRecruitSchedule" parameterType="RecruitSchedule">
        UPDATE recruit_schedule
        SET rec_name        = #{recName},
            rec_description = #{recDescription},
            is_rec_active   = #{isRecActive}
        WHERE rec_no = #{recNo};

        UPDATE recruit_period
        SET apply_start     = #{applyStart},
            apply_end       = #{applyEnd},
            first_announce  = #{firstAnnounce},
            interview_start = #{interviewStart},
            interview_end   = #{interviewEnd},
            second_announce = #{secondAnnounce}
        WHERE rec_no = #{recNo};
    </update>

    <select id="isRecruitScheduleExistByRecNo" parameterType="int" resultType="boolean">
        SELECT EXISTS(SELECT * FROM recruit_schedule WHERE rec_no = #{recNo}) AS result;
    </select>
    
    <!-- 지원자 관련 쿼리 -->
    <insert id="saveApplicant" parameterType="DasomApplicant">
        INSERT INTO dasom_applicant(ac_student_no, ac_name, ac_contact, ac_email,
                                    ac_department, ac_grade, reason_for_apply, rec_no)
        VALUES (#{acStudentNo}, #{acName}, #{acContact}, #{acEmail}, #{acDepartment},
                #{acGrade}, #{reasonForApply}, #{recNo})
    </insert>

    <select id="getApplicantList" parameterType="int" resultType="DasomApplicantIndex">
        SELECT * FROM applicant_list_index WHERE rec_no = #{recNo}
    </select>

    <select id="getApplicantByStudentNo" parameterType="int" resultType="DasomApplicant">
        SELECT * FROM dasom_applicant WHERE rec_no = #{recNo} AND ac_student_no = #{studentNo}
    </select>

    <update id="updateApplicantInfo" parameterType="DasomApplicantUpdate">
        UPDATE dasom_applicant SET ac_name = #{acName}, ac_contact = #{acContact}, ac_email = #{acEmail}, ac_department = #{acDepartment},
                                   ac_grade = #{acGrade}, reason_for_apply = #{reasonForApply}, rec_no = #{recNo}
        WHERE rec_no = #{originRecNo} AND ac_student_no = #{originAcStudentNo}
    </update>

    <delete id="deleteApplicantByStudentNo" parameterType="int">
        DELETE FROM dasom_applicant WHERE rec_no = #{recNo} AND ac_student_no = #{acStudentNo}
    </delete>

    <select id="isApplicantExistByRecNoAndStudentNo" parameterType="int" resultType="boolean">
        SELECT EXISTS(SELECT * FROM dasom_applicant WHERE rec_no = #{recNo} AND ac_student_no = #{acStudentNo})
    </select>

</mapper>
